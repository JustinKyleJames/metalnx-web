version: '3'
# requires the METALNX_ETC_DIR environment to 
services:
  metalnx-database:
      container_name: metalnx-database
      image: "postgres" # use latest official postgres version
      env_file:
        - database.env # configure postgres
      volumes:
        - database-data:/var/lib/postgresql/data/ # persist data even if container shuts down
      ports:
        - "5432:5432" 
      networks:
        - 4-2_irodsnet
  metalnx:
      image: "metalnx" # 
      container_name: metalnx
      build:
        context: ../
        dockerfile: Dockerfile
      volumes:
        - ${METALNX_ETC_DIR}:/etc/irods-ext
      ports:
        - "8080:8080" 
      networks:
        - 4-2_irodsnet
  database-init:
    container_name: database-init
    build:
        context: .
        dockerfile: Dockerfile.databaseinit
    volumes:
      - ..:/usr/src/metalnx-web
    networks:
        - 4-2_irodsnet

volumes:
  database-data: # named volumes can be managed easier using docker-compose

networks:
   4-2_irodsnet:
    external: true
     


  
